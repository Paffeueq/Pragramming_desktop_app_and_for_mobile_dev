Tworzenie API REST
MateriaÅ‚y wideo
Explore, Test, & Debug API Endpoints in Visual Studio Faster Than Ever!
Faster API Development in Visual Studio is Here! Say Hello to .http/.rest Files!
.NET 9 Web API & Entity Framework ğŸš€ Full Course: CRUD, Code-First Migrations & SQL Server
.NET 7 Minimal API for Beginners ğŸš€ Full CRUD in 10 Minutes!
Connect from your Blazor app to your API
Configure Blazor WebAssembly with Entra ID (.NET 8)
Tematy do poruszenia
Stworzenie nowego Web API w Visual Studio
Uruchomienie API â€“ omijanie zabezpieczenia SSL w Chrome:
w przeglÄ…darce wpisaÄ‡ chrome://flags/#allow-insecure-localhost i ustawiÄ‡ na Enabled
omÃ³wienie generowania certyfikatÃ³w SSL deweloperskich
Testowanie API:
w Swaggerze
w curlu â€“ mini program do testowania API w konsoli
w Postmanie â€“ rozbudowany program do testowania API
w przeglÄ…darce
w Visual Studio uÅ¼ywajÄ…c plikÃ³w .http
OmÃ³wienie czasownikÃ³w HTTP i zasady dziaÅ‚ania kontrolerÃ³w â€“ np. na przykÅ‚adzie WeatherForecastController
PoÅ‚Ä…czenie siÄ™ z API i uÅ¼ycie schematÃ³w (models, DTOs, contracts)
Autentykacja i autoryzacja (OAuth 2.0 / OpenID Connect): logowanie przez Google i Microsoft Entra ID (tenant, Application/Client ID, Secret, Redirect URI, wymiana kodu na token)
Ä†wiczenia
1. Stworzenie projektu Web API
dotnet new webapi -n ShopAPI.Api
cd ShopAPI.Api
code .
dotnet run
Test startowy: https://localhost:7294/swagger/index.html

2. Certyfikat developerski i HTTPS
HTTPS dziaÅ‚a od poczÄ…tku, nawet w trybie lokalnym.
Certyfikat developerski chroni transmisjÄ™ w Å›rodowisku deweloperskim.
dotnet dev-certs https --check
dotnet dev-certs https --trust
Chrome â†’ chrome://flags/#allow-insecure-localhost â†’ Enabled

3. Testowanie API
Swagger
curl
Postman
Pliki .http w VS Code
PrzeglÄ…darka (dla GET)
4. Czasowniki HTTP i dobre praktyki REST
REST korzysta z kilku podstawowych metod, ale warto znaÄ‡ ich szerszy zestaw:

GET â€“ pobieranie danych
POST â€“ dodawanie nowych danych
PUT â€“ aktualizacja caÅ‚ego zasobu
PATCH â€“ czÄ™Å›ciowa aktualizacja (np. tylko jednego pola)
DELETE â€“ usuniÄ™cie zasobu
HEAD â€“ pobiera tylko nagÅ‚Ã³wki (np. do sprawdzenia, czy zasÃ³b istnieje)
OPTIONS â€“ zwraca, jakie metody sÄ… dostÄ™pne dla danego endpointu
Ä†wiczenie 1 â€“ proste przykÅ‚ady
W CitiesController utwÃ³rz endpointy:

GET /api/cities â†’ pobiera wszystkie miasta
GET /api/cities/{id} â†’ pobiera jedno miasto
POST /api/cities â†’ dodaje nowe miasto
PUT /api/cities/{id} â†’ aktualizuje caÅ‚e miasto
PATCH /api/cities/{id} â†’ zmienia tylko jedno pole (np. Country)
DELETE /api/cities/{id} â†’ usuwa miasto
HEAD /api/cities/{id} â†’ sprawdza, czy miasto istnieje (status 200/404)
OPTIONS /api/cities â†’ zwraca listÄ™ dostÄ™pnych metod (Allow: GET, POST, PUT, PATCH, DELETE)
5. DTO i modele
public class CityDto 
{
    public string Name { get; set; }
    public string Country { get; set; }
}
OmÃ³w:

DTO = obiekt wymiany danych
oddziela API od logiki biznesowej
6. Statusy HTTP â€“ praktyczne scenariusze
Kod	Znaczenie	PrzykÅ‚ad
200 OK	poprawne pobranie	GET miast
201 Created	nowy zasÃ³b utworzony	POST miasto
204 No Content	usuniÄ™to, brak treÅ›ci	DELETE
400 Bad Request	zÅ‚a skÅ‚adnia danych	POST bez pola Name
401 Unauthorized	brak autoryzacji	brak JWT tokena
403 Forbidden	uÅ¼ytkownik nie ma uprawnieÅ„	np. zwykÅ‚y user prÃ³buje usunÄ…Ä‡ admina
404 Not Found	zasÃ³b nie istnieje	GET /cities/999
409 Conflict	konflikt danych	prÃ³ba dodania istniejÄ…cego miasta
500 Internal Server Error	bÅ‚Ä…d serwera	wyjÄ…tek w kodzie
ğŸ‘‰ Ä†wiczenie: w POST zwrÃ³Ä‡ 201 Created z nagÅ‚Ã³wkiem Location. ğŸ‘‰ Ä†wiczenie: w PUT zwrÃ³Ä‡ 404, jeÅ›li miasto nie istnieje. ğŸ‘‰ Ä†wiczenie: w PATCH zwrÃ³Ä‡ 409, jeÅ›li prÃ³ba zmiany koliduje z innymi danymi.

7. Schematy i generowanie klienta
Swagger â†’ swagger.json zawiera definicje endpointÃ³w i modeli.
MoÅ¼na generowaÄ‡ klienta automatycznie (NSwag, OpenAPI Generator).
ğŸ‘‰ Ä†wiczenie:

OtwÃ³rz https://localhost:7294/swagger/v1/swagger.json.
ZnajdÅº definicjÄ™ CityDto.
PokaÅ¼, Å¼e na tej podstawie moÅ¼na wygenerowaÄ‡ klasÄ™ klienta w C#.
8. WysyÅ‚anie zapytaÅ„ do API z aplikacji klienckiej
Ä†wiczenie â€“ prosta aplikacja konsolowa
UtwÃ³rz nowy projekt:

dotnet new console -n ShopAPI.Client
cd ShopAPI.Client
Dodaj pakiet:

dotnet add package System.Net.Http.Json
W Program.cs:

using System.Net.Http.Json;

var client = new HttpClient();
client.BaseAddress = new Uri("https://localhost:7294");

// GET
var cities = await client.GetFromJsonAsync<List<CityDto>>("/api/cities");
Console.WriteLine($"Miasta: {string.Join(", ", cities.Select(c => c.Name))}");

// POST
var newCity = new CityDto { Name = "Warsaw", Country = "Poland" };
var response = await client.PostAsJsonAsync("/api/cities", newCity);
Console.WriteLine($"Dodano miasto, status: {response.StatusCode}");
9. Ä†wiczenia dodatkowe â€“ â€REST w realnym Å›wiecieâ€
1. Paginacja i filtrowanie
GET /api/cities?page=1&pageSize=10
GET /api/cities?country=Poland
omÃ³w, dlaczego nie zwracamy od razu caÅ‚ej bazy.
2. Walidacja danych
Dodaj [Required] do CityDto.Name.
OmÃ³w walidacjÄ™ automatycznÄ… i status 400.
3. Idempotencja metod
GET, PUT, DELETE sÄ… idempotentne (wielokrotne wywoÅ‚anie daje ten sam efekt).
POST nie jest (dodaje za kaÅ¼dym razem nowy obiekt).
4. HATEOAS â€“ linki w odpowiedzi
W GET /cities/{id} oprÃ³cz danych zwrÃ³Ä‡ linki do:
PUT (edycja),
DELETE (usuniÄ™cie).
DziÄ™ki temu klient â€wieâ€, jakie akcje sÄ… moÅ¼liwe.
10. Autentykacja i autoryzacja (OAuth 2.0 / OpenID Connect)
Podstawy:

Flow: Authorization Code + PKCE (dla SPA/native) lub Authorization Code (dla aplikacji serwerowych).
Kluczowe elementy: Tenant, Client/Application ID, Client Secret (dla â€confidential clientsâ€), Redirect URI, Scopes (openid, profile, email), Token endpoints.
Logowanie w przeglÄ…darce â†’ kod autoryzacyjny â†’ wymiana na tokeny (access_token, id_token, refresh_token).
Google (Google Cloud Console):

UtwÃ³rz OAuth consent screen (External/Internal), dodaj zakresy: openid, email, profile.
UtwÃ³rz OAuth Client ID: typ (Web/SPA/Android/iOS), ustaw Redirect URI (np. https://localhost:7294/signin-oidc albo dla SPA: http://localhost:5173/callback).
Zanotuj: Client ID, Client Secret (jeÅ›li wymagane), Redirect URIs.
Autoryzacja:
Authorize endpoint: https://accounts.google.com/o/oauth2/v2/auth
Token endpoint: https://oauth2.googleapis.com/token
PrzykÅ‚ad Å¼Ä…dania (PKCE, skrÃ³towo):
GET authorize z parametrami: client_id, redirect_uri, response_type=code, scope=openid email profile, code_challenge, code_challenge_method=S256, state.
Wymiana kodu: POST do token endpoint z code, client_id, redirect_uri, code_verifier (+ client_secret dla confidential).
Weryfikacja id_token (JWT) podpisu i aud, iss.
Microsoft Entra ID (Azure Portal):

Tenant: zapis Directory (tenant) ID.
App registrations: zarejestruj aplikacjÄ™, dodaj Redirect URIs, wÅ‚Ä…cz â€ID tokensâ€.
Zanotuj: Application (client) ID, Directory (tenant) ID, Client Secret (jeÅ›li potrzebny).
Endpoints (v2.0):
Authorize: https://login.microsoftonline.com/{tenant}/oauth2/v2.0/authorize
Token: https://login.microsoftonline.com/{tenant}/oauth2/v2.0/token
Scope: openid profile email (+ offline_access dla refresh), dla API: api://<app-id>/.<scope> lub Microsoft Graph: https://graph.microsoft.com/.default.
UÅ¼yj PKCE dla public clients; dla confidential doÅ‚Ä…cz client_secret.
Integracja w .NET API (skrÃ³t):

API zwykle weryfikuje JWT (Bearer) zamiast wykonywaÄ‡ interaktywny login.
Konfiguracja (Minimal API):
AddAuthentication(JwtBearer).AddJwtBearer z Authority (np. Entra: https://login.microsoftonline.com/{tenant}/v2.0 lub Google: https://accounts.google.com) i Audience (Client ID / API App ID URI).
Klient (SPA/Native) wykonuje login przez przeglÄ…darkÄ™ i przekazuje access_token w Authorization: Bearer <token>.
Ä†wiczenia:

Skonfiguruj aplikacjÄ™ w Entra ID i zaloguj uÅ¼ytkownika przez Authorization Code + PKCE, wyÅ›wietl id_token claims (sub, name, email).
Skonfiguruj login przez Google, odbierz code, wymieÅ„ na access_token, zweryfikuj id_token.
Dodaj do API middleware JWT Bearer i zabezpiecz endpointy [Authorize].